<div class="mt-5" *ngIf="article">
  <section *ngIf="!editing && !creating">
    <article>
      <header class="mb-4">
        <h1 class="display-4">{{ article.title }}</h1>
        <p class="text-muted">
          By author | {{ article.created | date : 'dd/MM/yyyy HH:mm' }}{{ article.updated ? ', (updated ' + (article.updated | date : 'dd/MM/yyyy HH:mm') + ')': '' }}
          <fa-icon [icon]="faCoffee"></fa-icon>
        </p>
      </header>

      <!-- build an image api to return blob -->
      <img src="assets/images/Mercedes-AMG1.jpg" class="img-fluid rounded mb-4 w-100" alt="{{ article.title }}" />

      <section class="content">
        <div [innerHTML]="article.content"></div>
      </section>

      <!-- comments -->
      <app-comments [article]="article" [isLoggedIn]="(isLoggedIn$ | async) ?? false"></app-comments>

      <footer class="mt-5">
        <h5>About the Author</h5>
        <p>author</p>
      </footer>

      <!-- editor button -->
      <section class="mt-3 mb-5">
        <a class="btn btn-sm btn-outline-success me-2"
           [routerLink]="['/login']"
           [queryParams]="{ returnUrl: router.url }"
           *ngIf="!(isLoggedIn$ | async) ?? false">
          Login to edit article
        </a>
        <button class="btn btn-sm btn-outline-success me-2"
                (click)="edit()"
                *ngIf="(isLoggedIn$ | async) ?? false">
          edit
        </button>
      </section>

      <a class="me-2" [routerLink]="['/articles']">back to articles</a>
    </article>
  </section>

  <!-- editor -->
  <section *ngIf="(creating || editing) && form">
    <form [formGroup]="form">
      <section>
        <label for="title" class="fw-bold">Title</label>
        <input type="text" class="form-control" id="title" placeholder="Article title" formControlName="title" />
      </section>

      <editor *ngIf="form"
              apiKey="{{tinyMCESecret}}"
              #contentEditor id="contentEditor"
              formControlName="content"
              [init]="editorInitialisation"
              [initialValue]="article.content">
      </editor>

      <section class="mt-3 mb-3">
        <button class="btn btn-sm btn-success me-2" (click)="editing? update() : create()" *ngIf="isLoggedIn">{{editing? 'update' : 'create'}}</button>
        <a class="btn btn-sm btn-outline-success me-2" [routerLink]="['/login']"
           [queryParams]="{ returnUrl: router.url }"
           *ngIf="!(isLoggedIn$ | async) ?? false">
          Login to {{editing? 'update' : 'create'}} article
        </a>
        <button class="btn btn-sm btn-warning me-2" (click)="editing? updateCancel() : createCancel()">cancel</button>
      </section>
    </form>
  </section>
</div>
